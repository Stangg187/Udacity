<script>
var parseDefintion = function(atlasJSON){

var json = JSON.parse(atlasJSON);

var frames = json['frames'];
        for(var sprite in frames){
            var x = frames[sprite].frame.x,
                y = frames[sprite].frame.y,
                w = frames[sprite].frame.w,
                h = frames[sprite].frame.h,
                cx = -1*(frames[sprite].frame.w/2),
                cy = -1*(frames[sprite].frame.h/2),
                nm = sprite;

                if(sprite.trimmed === true){
                cx = -1*(sprite.sourceSize.w * 0.5) + sprite.spriteSourceSize.x;
                cy = -1*(sprite.sourceSize.h * 0.5) + sprite.spriteSourceSize.y;
                }
            
            this.defSprite(nm, x, y, w, h, cx, cy);   
        }
        
	}
}
function drawSprite(spritename, posX, posY) {
    for(var sprite in gSpriteSheets){
        var sheetInstance = gSpriteSheets[sprite];
        var spriteInstance = sheetInstance.getStats(spritename);
        if(spriteInstance){
            __drawSpriteInternal(spriteInstance, sheetInstance, posX, posY);
        }
    }
}

function __drawSpriteInternal(spt, sheet, posX, posY) {
    if(!spt || !sheet){
        return null;
    }
    
    ctx.drawImage(sheet.img, spt.x, spt.y, spt.w, spt.h, posX + spt.cx, posY + spt.cy, spt.w, spt.h);
}

function xhrGet(reqUri,callback) {
        var xhr = new XMLHttpRequest();

        xhr.open("GET", reqUri, true);
        xhr.onload = callback;

        xhr.send();
}
var fullyloaded = false;
var load = function (map) {

        // Perform an XMLHttpRequest to grab the
        // JSON file at url 'map'. We've provided
        // the xhrGet function from the optional
        // unit for you to use if you want.
        //
        // Once the XMLHttpRequest loads, set the
        // 'fullyLoaded' flag to true.
        //
        // YOUR CODE HERE
        var mappy = xhrGet(map, function(){
            this.fullyLoaded = true;
        });
        
        return mappy;
        
        
    }



<!-- atlasJSON -->
    {
    "frames": {

        "chaingun.png": {
            "frame": {
                "x": 1766,
                "y": 202,
                "w": 42,
                "h": 34
            },
            "rotated": false,
            "trimmed": true,
            "spriteSourceSize": {
                "x": 38,
                "y": 32,
                "w": 42,
                "h": 34
            },
            "sourceSize": {
                "w": 128,
                "h": 128
            }
        },
        "chaingun_impact.png": {
            "frame": {
                "x": 1162,
                "y": 322,
                "w": 38,
                "h": 34
            },
            "rotated": false,
            "trimmed": true,
            "spriteSourceSize": {
                "x": 110,
                "y": 111,
                "w": 38,
                "h": 34
            },
            "sourceSize": {
                "w": 256,
                "h": 256
            }
        },
        "chaingun_impact_0000.png": {
            "frame": {
                "x": 494,
                "y": 260,
                "w": 22,
                "h": 22
            },
            "rotated": false,
            "trimmed": true,
            "spriteSourceSize": {
                "x": 113,
                "y": 108,
                "w": 22,
                "h": 22
            },
            "sourceSize": {
                "w": 256,
                "h": 256
            }
        },
        "chaingun_impact_0001.png": {
            "frame": {
                "x": 1500,
                "y": 1904,
                "w": 34,
                "h": 30
            },
            "rotated": false,
            "trimmed": true,
            "spriteSourceSize": {
                "x": 104,
                "y": 104,
                "w": 34,
                "h": 30
            },
            "sourceSize": {
                "w": 256,
                "h": 256
            }
        },
        "chaingun_impact_0002.png": {
            "frame": {
                "x": 888,
                "y": 366,
                "w": 38,
                "h": 32
            },
            "rotated": false,
            "trimmed": true,
            "spriteSourceSize": {
                "x": 106,
                "y": 105,
                "w": 38,
                "h": 32
            },
            "sourceSize": {
                "w": 256,
                "h": 256
            }
        },
        "chaingun_impact_0003.png": {
            "frame": {
                "x": 990,
                "y": 84,
                "w": 32,
                "h": 28
            },
            "rotated": false,
            "trimmed": true,
            "spriteSourceSize": {
                "x": 113,
                "y": 109,
                "w": 32,
                "h": 28
            },
            "sourceSize": {
                "w": 256,
                "h": 256
            }
        }
    },
    "meta": {
        "app": "http://www.texturepacker.com",
        "version": "1.0",
        "image": "grits_effects.png",
        "format": "RGBA8888",
        "size": {
            "w": 2048,
            "h": 2048
        },
        "scale": "1",
        "smartupdate": "$TexturePacker:SmartUpdate:a5e0b1932a348d048c58a625408c4276$"
    }
}
}
</script>

{
    "frames": {

        "chaingun.png": {
            "frame": {
                "x": 1766,
                "y": 202,
                "w": 42,
                "h": 34
            },
            "rotated": false,
            "trimmed": true,
            "spriteSourceSize": {
                "x": 38,
                "y": 32,
                "w": 42,
                "h": 34
            },
            "sourceSize": {
                "w": 128,
                "h": 128
            }
        },
        "chaingun_impact.png": {
            "frame": {
                "x": 1162,
                "y": 322,
                "w": 38,
                "h": 34
            },
            "rotated": false,
            "trimmed": true,
            "spriteSourceSize": {
                "x": 110,
                "y": 111,
                "w": 38,
                "h": 34
            },
            "sourceSize": {
                "w": 256,
                "h": 256
            }
        },
        "chaingun_impact_0000.png": {
            "frame": {
                "x": 494,
                "y": 260,
                "w": 22,
                "h": 22
            },
            "rotated": false,
            "trimmed": true,
            "spriteSourceSize": {
                "x": 113,
                "y": 108,
                "w": 22,
                "h": 22
            },
            "sourceSize": {
                "w": 256,
                "h": 256
            }
        },
        "chaingun_impact_0001.png": {
            "frame": {
                "x": 1500,
                "y": 1904,
                "w": 34,
                "h": 30
            },
            "rotated": false,
            "trimmed": true,
            "spriteSourceSize": {
                "x": 104,
                "y": 104,
                "w": 34,
                "h": 30
            },
            "sourceSize": {
                "w": 256,
                "h": 256
            }
        },
        "chaingun_impact_0002.png": {
            "frame": {
                "x": 888,
                "y": 366,
                "w": 38,
                "h": 32
            },
            "rotated": false,
            "trimmed": true,
            "spriteSourceSize": {
                "x": 106,
                "y": 105,
                "w": 38,
                "h": 32
            },
            "sourceSize": {
                "w": 256,
                "h": 256
            }
        },
        "chaingun_impact_0003.png": {
            "frame": {
                "x": 990,
                "y": 84,
                "w": 32,
                "h": 28
            },
            "rotated": false,
            "trimmed": true,
            "spriteSourceSize": {
                "x": 113,
                "y": 109,
                "w": 32,
                "h": 28
            },
            "sourceSize": {
                "w": 256,
                "h": 256
            }
        }
    },
    "meta": {
        "app": "http://www.texturepacker.com",
        "version": "1.0",
        "image": "grits_effects.png",
        "format": "RGBA8888",
        "size": {
            "w": 2048,
            "h": 2048
        },
        "scale": "1",
        "smartupdate": "$TexturePacker:SmartUpdate:a5e0b1932a348d048c58a625408c4276$"
    }
}